package com.tomtom.security.shiro.aspectj;

import org.aspectj.lang.JoinPoint;
import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.Before;
import org.aspectj.lang.annotation.Pointcut;

/**
 * TomTom International BV Proprietary
 *
 * @author Ilya Pimenov
 */
@Aspect()
public class TomTomAnnotationAuthorizingAspect {

    private static final String pointCupExpression =
            "execution(@com.tomtom.security.shiro.annotation.RequireDeviceAssociation * *(..))";
    /*---------------------------------------------------------------------------------------------------------------
    | Notta Bene: Add new pointCups in the same string, they will go like:                                          |
    | private static final String pointCupExpression =                                                              |
    |       "execution(@com.tomtom.security.shiro.annotation.RequireDeviceAssociation * *(..)) || " +               |
    |           "execution(@com.tomtom.security.shiro.annotation.SecondNiceAnnotation * *(..)) || " +;              |
    |           "execution(@com.tomtom.security.shiro.annotation.ThirdNiceAnnotation * *(..))";                     |
    | Sadly, it will be a bit more tricky for argument matching&nbsp;&#151; {@link TomTomAnnotationArgumentsAspect} |
    |                                                                                                               |
    | ps. hope this comment is big enough                                                                           |
    ===============================================================================================================*/

    @Pointcut(pointCupExpression)
    public void anyTomTomAnnotatedMethod() {
    }

    @Pointcut(pointCupExpression)
    void anyTomTomAnnotatedMethodCall(JoinPoint thisJoinPoint) {
    }

    private AspectjAnnotationsTomTomAuthorizingMethodInterceptor interceptor = new AspectjAnnotationsTomTomAuthorizingMethodInterceptor();

    @Before("anyTomTomAnnotatedMethodCall(thisJoinPoint)")
    public void executeAnnotatedMethod(JoinPoint thisJoinPoint) throws Throwable {
        interceptor.performBeforeInterception(thisJoinPoint);
    }
}
